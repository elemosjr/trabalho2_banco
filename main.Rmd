---
output:
  pdf_document:
    latex_engine: xelatex
    df_print: kable
documentclass: article
classoption: a4paper
fontsize: 12pt
geometry: left=2cm, right=2cm, top=3cm, bottom=1.5cm
header-includes:
  - \usepackage{float}
  - \usepackage[T1]{fontenc}
  - \usepackage{hyperref}
  - \pagenumbering{gobble}
  - \usepackage{draftwatermark}
  - \SetWatermarkText{\includegraphics{fundo.pdf}}
  - \SetWatermarkAngle{0}
  - \SetWatermarkScale{1.25}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, results = "asis")
```


```{python, include = FALSE}
import sqlite3
import os
import pandas as pd

def print_sql(caminho_arquivo):
    with open(caminho_arquivo) as arquivo:
        print(f"```sql\n{arquivo.read()}\n```")

def print_consulta(consulta, colunas: list):
    print(
        pd.DataFrame(consulta, columns = colunas).to_markdown(index = False)
    )

class Conexao:
    """Classe para admnistrar a conexão com sqlite3."""
    def __init__(self, nome):
        self.nome = nome

    def __enter__(self):
        self.conn = sqlite3.connect(self.nome)
        return self.conn.cursor()

    def __exit__(self, type, value, traceback):
        self.conn.commit()
        self.conn.close()

nome_banco = "teste.db"

if os.path.exists(nome_banco):
    os.remove(nome_banco)

arquivo_criar = os.path.join("sql", "criar.sql")

arquivo_inserir = os.path.join("sql", "inserir.sql")

arquivo_consulta = os.path.join("sql", "consultas.sql")
```

\begin{titlepage}
  \begin{center}
    \vspace*{80pt}
    \Huge\textbf{Universidade Estadual de Maringá}\\
    \Huge\textbf{Banco de Dados}\\
    \vspace{30pt}
    \LARGE\textbf{Trabalho 1 - Projeto de Banco de Dados:}\\
    \LARGE\textbf{Modelos Conceitual e Lógico}
  \end{center}

  \vspace{100pt}
  \begin{center}
	
  {\raggedright
    \begin{minipage}[t]{10cm}
    \setlength{\baselineskip}{0.25in}
    \vspace{5pt}
    {\large \textbf{Professor:}} Me. André Felipe Ribeiro Cordeiro\\
  	{\large \textbf{Alunos:}}
  	  \text{Eduardo José de Campos Lemos Júnior (ra106561)} \\
  	  \text{\hspace{2.065cm}Mariana Sabiar Podanoscki (ra108513)} \\
  	\end{minipage}\\[1cm]
   }
   \vfill
   \textrm{Maringá \\ 
   Novembro de 2021}
  \end{center}

\end{titlepage}


\newpage

\tableofcontents

\newpage

# Criando Tabelas

```{python criar_sql, include = FALSE}
with open(arquivo_criar) as arquivo:
    criar = arquivo.read().split(";")

with Conexao(nome_banco) as cur:
    for query in criar:
        cur.execute(query)
```

```{python print_criar_sql}
print_sql(arquivo_criar)
```

\newpage

# Consultas

## Proposta de consultas

1.   Professores que podem dar aula de Cálculo I.
2.   Alunos que foram aprovados por nota mas reprovados por falta.
3.   Professores do departamento de matemarica que tem qualificacao para alguma matéria do curso de estatística

## Inserção dos dados

```{python inserir_sql, include = FALSE}
with open(arquivo_inserir) as arquivo:
    inserir = arquivo.read().split(";")

with Conexao(nome_banco) as cur:
    for query in inserir:
        cur.execute(query)
```

```{python print_inserir_sql}
print_sql(arquivo_inserir)
```

## Consulta 1

```{python init_consultas_sql, include = FALSE}
with open(arquivo_consulta) as arquivo:
    consultas = arquivo.read().split(";")

with Conexao(nome_banco) as cur:
    cur.execute(consultas[0])
    consulta_1 = cur.fetchall()
    cur.execute(consultas[1])
    consulta_2 = cur.fetchall()
    cur.execute(consultas[2])
    consulta_3 = cur.fetchall()
```

```{python print_consulta_1_sql}
print(f"```sql\n{consultas[0]};\n```")
```

```{python}
print_consulta(consulta_1, ["Nome"])
```

# Consulta 2

```{python print_consulta_2_sql}
print(f"```sql\n{consultas[1]};\n```")
```

```{python}
print_consulta(consulta_2, ["Nome"])
```


# Consulta 3
```sql

```



\newpage

# Resultados
